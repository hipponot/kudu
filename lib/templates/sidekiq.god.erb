project = "<%=project_name%>"
app = "<%=project_name%>-<%=project_version%>"
gem_home="/home/#{ENV['USER']}/.rvm/gems/#{ENV['RUBY_VERSION']}@#{app}"
gem_path="#{gem_home}:/home/#{ENV['USER']}/.rvm/gems/#{ENV['RUBY_VERSION']}@global"
app_root="/home/#{ENV['USER']}/.rvm/gems/#{ENV['RUBY_VERSION']}@#{app}/gems/#{app}"
set_path="export GEM_HOME=#{gem_home};export GEM_PATH=#{gem_path}"
God.watch do |w|
  w.name = app
  w.start = "#{set_path}; sidekiq -C #{app_root}/config/sidekiq.yaml -L /var/log/unicorn/#{app}/sidekiq.log -P /tmp/unicorn/pids/#{app}/sidekiq.pid -r #{app_root}/lib/#{project}.rb"
  w.stop = "#{set_path}; sidekiqctrl stop /tmp/unicorn/pids/#{app}/sidekiq.pid"
  w.keepalive(:memory_max => 100.megabytes)
end

